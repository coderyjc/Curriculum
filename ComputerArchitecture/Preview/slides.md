# 计算机系统结构

## 基本概念

### 层次结构

- 应用语言虚拟机

  - 应用语言
- 高级语言虚拟机

  - 高级语言
- 汇编语言虚拟机

  - 汇编语言
- 操作系统虚拟机

  - 传统机器级指令+操作系统级指令
- 机器语言（传统机器级）

  - 机器指令集
- 微程序机器级

  - 微指令集（固件、硬件）

---

### 历史发展

- 冯诺依曼结构

  - 如何改进？

    - 指令集的发展
    - 存储器组织结构
    - 输入输出方式
    - 并行处理技术
- 并行性的发展

  - 如何提高并行性
  - 单机系统中并行性的发展
  - 多机系统中并行性的发展
- 宏观上如何改进？

  - 软件（可移植性）
  - 硬件（摩尔定律）
  - 应用（特殊领域）

---

### 性能评估

- 定量分析技术

  - 经常性时间为重点
  - Amdahl定律
  - CPU性能公式
  - 程序的局部性原理

---

## 指令集结构

### 是什么

- 分类

  - 堆栈
  - 累加器
  - 通用寄存器组

    - 寄存器-存储器
    - 寄存器-寄存器

- 寻址方式

### 如何设计

- 功能设计

  - 确定哪些功能由硬件实现，哪些用软件实现
  - CISC功能设计

    - 优化逻辑

      - 面向目标程序

        - 指令代替复杂运算
        - 设计组传送指令
        - 增强程序控制指令

      - 面向高级语言

        - 对高级语言和编译器的支持
        - 高级语言计算机

      - 面向操作系统

  - RISC功能设计

    - 优化逻辑

      - 精简
      - 统一格式
      - 限制完成指令的周期数
      - 限制访存指令
      - 硬连逻辑实现指令
      - 编译优化
      - 流水

- 操作数和寻址方式

  - 寻址方式表示方法

    - 与操作数一起编码
    - 设置专门的地址描述符

  - 指令集的编码格式

    - 可变长度的编码格式
    - 固定长度的编码格式
    - 混合型编码格式

### 举个栗子？——MIPS

## 流水线技术

### 基本概念

- 分类

  - 单功能流水线与多功能流水线
  - 静态流水线和动态流水线
  - 部件级、处理机级和处理机间流水线
  - 线性流水线和非线性流水线
  - 顺序流水线和乱序流水线

### 性能如何评估

- 吞吐率
- 加速比
- 效率

### 存在的问题

- 瓶颈问题（流水线各段不均匀）
- 额外开销（流水寄存器和时钟偏移开销）
- 冲突问题
- 相关与冲突

  - 相关（两条指令之间存在联系）

    - 数据相关（真数据相关）

      - 写后读

    - 名相关

      - 反相关（读后写）
      - 输出相关（同时写）

    - 控制相关

  - 冲突

    - 结构冲突（硬件资源不足）

      - 解决：在前一个指令访问存储器时将流水线停顿一个时钟周期（起泡）

    - 数据冲突（指令重叠）

      - 写后读
      - 写后写
      - 读后写

    - 控制冲突（PC改变）

### 举个栗子？实现一个流水线？

### 【进阶】向量处理机

- 处理方式
- 结构
- 如何提高性能
- 性能评价

## 存储系统

### 存储层次结构

- CPU-Cache-主存
- 要解决的问题

  - 映像规则

    - 全相联
    - 直接映像
    - 组相联

  - 查找算法
  - 替换算法

    - 随机法
    - FIFO
    - LRU

      - 堆栈法
      - 比较对法

  - 写策略

    - 写直达法
    - 写回法
    - 写不命中

      - 按写分配
      - 不按写分配

### 改进Cache性能

- 降低不命中率

  - 强制性不命中
  - 容量不命中
  - 冲突不命中
  - 方法

    - 增加块大小
    - 增加Cache容量
    - 提高相联度
    - ”牺牲”Cache
    - 伪相联Cache
    - 硬件预取指令和数据
    - 编译器控制的预取
    - 用编译技术减少Cahce不命中次数

- 减少不命中开销

  - 使读不命中优先于写
  - 写缓冲合并
  - 金奥重启动和关键字有限
  - 非阻塞Cache
  - 两级Cache

- 减少命中时间

  - 小而简单的Cache
  - 对Cache进行索引时不必进行地址转换
  - 流水化Cache访问
  - 踪迹Cache

### 并行主存系统

### 虚拟存储器

## IO系统

